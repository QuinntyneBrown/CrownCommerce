<!-- Page Header -->
<div class="page-header">
  <div>
    <h1 class="page-title">Meetings</h1>
    <p class="page-subtitle">{{ currentMonthYear() }}</p>
  </div>
  <button mat-flat-button color="primary" class="new-meeting-btn" (click)="openNewMeetingDialog()">
    <mat-icon>add</mat-icon>
    New Meeting
  </button>
</div>

<div class="content-area">
  <!-- Week Picker -->
  <div class="week-picker">
    @for (day of weekDays(); track day.dateStr) {
      <div class="day-cell"
           [class.day-cell--selected]="day.dateStr === selectedDate()"
           [class.day-cell--today]="day.isToday"
           (click)="selectDate(day.dateStr)">
        <span class="day-name">{{ day.dayName }}</span>
        <span class="day-number">{{ day.dayNumber }}</span>
      </div>
    }
  </div>

  <!-- Schedule -->
  <section>
    <h3 class="section-title">Schedule</h3>
    <div class="schedule-list">
      @for (meeting of filteredMeetings(); track meeting.id) {
        <mat-card class="schedule-card">
          <div class="schedule-accent" [style.background]="meeting.color"></div>
          <div class="schedule-body">
            <div class="schedule-time-col">
              <span class="schedule-start">{{ meeting.startTime }}</span>
              <span class="schedule-end">{{ meeting.endTime }}</span>
            </div>
            <div class="schedule-divider"></div>
            <div class="schedule-details">
              <span class="schedule-title">{{ meeting.title }}</span>
              <div class="schedule-meta">
                @if (meeting.isVirtual) {
                  <mat-icon class="meta-icon">videocam</mat-icon>
                  <span>Virtual Meeting</span>
                  @if (meeting.joinUrl) {
                    <button mat-stroked-button class="join-call-btn" (click)="joinMeeting(meeting)">
                      <mat-icon>video_call</mat-icon>
                      Join
                    </button>
                  }
                } @else {
                  <mat-icon class="meta-icon">location_on</mat-icon>
                  <span>{{ meeting.location }}</span>
                }
              </div>
              <div class="schedule-participants">
                @for (p of meeting.participants; track p.name; let i = $index) {
                  @if (i < 4) {
                    <div class="schedule-avatar" [style.z-index]="10 - i">{{ p.initials }}</div>
                  }
                }
                @if (meeting.participants.length > 4) {
                  <div class="schedule-avatar schedule-avatar--more">+{{ meeting.participants.length - 4 }}</div>
                }
              </div>
            </div>
            <div class="rsvp-actions">
              @if (meeting.rsvpStatus === 'Pending') {
                <button mat-stroked-button class="rsvp-btn rsvp-btn--accept" (click)="respondToMeeting(meeting, 'Accepted')">
                  <mat-icon>check</mat-icon>
                  Accept
                </button>
                <button mat-stroked-button class="rsvp-btn rsvp-btn--decline" (click)="respondToMeeting(meeting, 'Declined')">
                  <mat-icon>close</mat-icon>
                  Decline
                </button>
              } @else if (meeting.rsvpStatus === 'Accepted') {
                <span class="rsvp-badge rsvp-badge--accepted">
                  <mat-icon>check_circle</mat-icon>
                  Accepted
                </span>
              } @else if (meeting.rsvpStatus === 'Declined') {
                <span class="rsvp-badge rsvp-badge--declined">
                  <mat-icon>cancel</mat-icon>
                  Declined
                </span>
              }
            </div>
            <button mat-icon-button class="join-btn" [matMenuTriggerFor]="meetingMenu">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #meetingMenu="matMenu">
              <button mat-menu-item (click)="editMeeting(meeting)">
                <mat-icon>edit</mat-icon>
                <span>Edit</span>
              </button>
              <button mat-menu-item (click)="exportMeetingToICal(meeting)">
                <mat-icon>download</mat-icon>
                <span>Export iCal</span>
              </button>
              <button mat-menu-item (click)="cancelMeeting(meeting)">
                <mat-icon>cancel</mat-icon>
                <span>Cancel Meeting</span>
              </button>
            </mat-menu>
          </div>
        </mat-card>
      }
      @if (hasMoreMeetings()) {
        <div class="load-more-bar">
          <button class="load-more-btn" (click)="loadMoreMeetings()" [disabled]="isLoadingMore()">
            @if (isLoadingMore()) {
              Loading...
            } @else {
              Show more meetings
            }
          </button>
        </div>
      }
      @if (filteredMeetings().length === 0) {
        <div class="empty-state">
          <mat-icon>event_available</mat-icon>
          <span>No meetings scheduled for this day</span>
        </div>
      }
    </div>
  </section>
</div>
